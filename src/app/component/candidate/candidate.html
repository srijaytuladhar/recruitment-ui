<div class="card">
  <div class="header flex justify-content-between align-items-center mb-2">
    <h2>List of Candidates</h2>
    <p-button label="Create Profile" [raised]="true" severity="success" (click)="navigateTo('candidates/create')">
      <i class="pi pi-plus"></i>
    </p-button>
  </div>

  <div class="mb-3" style="max-width: 300px;">
    <p-iconfield>
      <p-inputicon class="pi pi-search"></p-inputicon>
      <input
        type="text"
        pInputText
        placeholder="Search candidates"
        (input)="dt1.filterGlobal($event.target.value, 'contains')"
      />
    </p-iconfield>
  </div>

  <div class="table-responsive">
    <p-table
      #dt1
      [value]="candidateList"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [globalFilterFields]="['name','currentAddress','emailAddress','contactNumber','jobLocationDesired','jobVertical','totalYearsOfExperience']"
      [scrollable]="true"
      [responsiveLayout]="'scroll'">

      <!-- Table Header -->
      <ng-template pTemplate="header">
        <tr>
          <th>Action</th>
          <th pSortableColumn="name">Name <p-sortIcon field="name"></p-sortIcon></th>
          <th pSortableColumn="emailAddress">Email <p-sortIcon field="emailAddress"></p-sortIcon></th>
          <th pSortableColumn="contactNumber">Contact <p-sortIcon field="contactNumber"></p-sortIcon></th>
          <th pSortableColumn="jobLocationDesired">Location <p-sortIcon field="jobLocationDesired"></p-sortIcon></th>
          <th pSortableColumn="jobVertical">Vertical <p-sortIcon field="jobVertical"></p-sortIcon></th>
          <th pSortableColumn="totalYearsOfExperience">Experience <p-sortIcon field="totalYearsOfExperience"></p-sortIcon></th>
          <th>Resume</th> <!-- New Resume Column -->
        </tr>
      </ng-template>

      <!-- Table Body -->
      <ng-template pTemplate="body" let-candidate>
        <tr (click)="navigateToView(candidate.id)" class="tr-hover">
          <td (click)="$event.stopPropagation()">
            <p-splitbutton label="" dropdownIcon="pi pi-cog" [model]="candidate.items"></p-splitbutton>
          </td>
          <td><div class="truncate-text">{{ candidate.name }}</div></td>
          <td><div class="truncate-text">{{ candidate.emailAddress }}</div></td>
          <td><div class="truncate-text">{{ candidate.contactNumber }}</div></td>
          <td><div class="truncate-text">{{ candidate.jobLocationDesired }}</div></td>
          <td><div class="truncate-text">{{ candidate.jobVertical }}</div></td>
          <td><div class="truncate-text">{{ candidate.totalYearsOfExperience }}</div></td>
          <td (click)="$event.stopPropagation()">
            <button
              pButton
              type="button"
              [icon]="candidate.resumeBase64 ? 'pi pi-eye' : 'pi pi-eye-slash'"
              class="p-button-text p-button-sm resume-btn"
              [disabled]="!candidate.resumeBase64"
              pTooltip="{{ !candidate.resumeBase64 ? 'No resume found' : '' }}"
              tooltipPosition="top"
              (click)="viewResume(candidate)">
            </button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="8">No candidates found.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<!-- Resume Preview Modal -->
<p-dialog
  header="Resume Preview"
  [(visible)]="displayResumeModal"
  [modal]="true"
  [closable]="true"
  [resizable]="true"
  [draggable]="false"
  [style]="{ width: '95vw', maxWidth: '95vw', height: '95vh', maxHeight: '95vh', padding: '0' }"
  [contentStyle]="{ height: 'calc(95vh - 50px)', overflow: 'auto', padding: '0' }">
  <ng-container *ngIf="resumeSrc">
    <iframe
      *ngIf="resumeMimeType === 'application/pdf'"
      [src]="resumeSrc | safe"
      width="100%"
      height="100%"
      style="border:none;"></iframe>
    <img
      *ngIf="resumeMimeType.startsWith('image/')"
      [src]="resumeSrc"
      width="100%"
      style="height:100%; object-fit:contain; display:block; margin:auto;" />
  </ng-container>
</p-dialog>
